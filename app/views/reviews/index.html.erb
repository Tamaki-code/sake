<h3 class="mt-2 text-center">レビュー 一覧</h3>
<h4 class="mt-2 text-center"><%= @sake.name %> </h4>

<% if @reviews.any? %>
  <% @reviews.each_with_index do |review, index| %>
    <div class="user-profile-container"> <!-- マイページと同じ枠 -->
      <div class="user-profile-box"> <!-- 枠のスタイルを適用 -->
        <p><strong>評価:</strong> <%= review.rating %></p>

         <!-- レーダーチャートを表示するキャンバス -->
        <canvas id="reviewRadarChart-<%= index %>" width="400" height="400"></canvas>

        <p><strong>華やか:</strong> <%= review.f1 %></p>
        <p><strong>辛さ:</strong> <%= review.spiciness %></p>
        <p><strong>淡白さ:</strong> <%= review.lightness %></p>
        <p><strong>濃醇さ:</strong> <%= review.richness %></p>
        <p><strong>香り:</strong> <%= review.aroma %></p>
        <p><strong>後味:</strong> <%= review.aftertaste %></p>
        <p><strong>飲み方:</strong> <%= review.drinking_style %></p>
        <p><strong>合う食事:</strong> <%= review.matching_food %></p>
        <p><strong>コメント:</strong> <%= review.comment %></p>
        <p><strong>投稿者:</strong> <%= review.user.username %></p> 

        <% if review.image.attached? %>
          <%= image_tag review.image, class: 'review-image' %> <!-- @review -> review に修正 -->
        <% else %>
          <p>画像がありません。</p>
        <% end %>

        <p><strong>記録日:</strong> <%= review.recorded_at %></p>
      </div>
    </div>
    
    <!-- チャートを描画するスクリプト -->
    <script>
      document.addEventListener('turbo:load', function() {
        var ctx = document.getElementById('reviewRadarChart-<%= index %>').getContext('2d');
        new Chart(ctx, {
          type: 'radar',
          data: {
            labels: ['甘さ', '辛さ', '淡白さ', '濃醇さ'],
            datasets: [{
              label: '<%= @sake.name %> の味わい',
              data: [<%= review.sweetness %>, <%= review.spiciness %>, <%= review.lightness %>, <%= review.richness %>],
              backgroundColor: 'rgba(75, 192, 192, 0.2)',
              borderColor: 'rgba(75, 192, 192, 1)',
              borderWidth: 2,
              pointBackgroundColor: 'rgba(75, 192, 192, 1)',
              pointBorderColor: '#fff',
              pointHoverBackgroundColor: '#fff',
              pointHoverBorderColor: 'rgba(75, 192, 192, 1)'
            }]
          },
          options: {
            responsive: true,
            scale: {
                min: 0,
                max: 5,
              ticks: {
                beginAtZero: true,
                stepSize: 1,
                callback: function(value) {
                  return value.toFixed(1);
                }
              }
            }
          }
        });
      });
    </script>
  <% end %>
<% else %>
  <div class="no-review-container">
    <div class="no-review-box">
      <p class="mt-2 text-center">この銘柄に関するレビューはまだありません。</p>
    </div>
  </div>
<% end %>

<div class= "center-container">
  <div class="botton-container">
    <%= link_to 'レビューを投稿する', new_sake_review_path(@sake), class: 'btn btn-custom' %>

    <div class="return-button mt-4">
      <%= link_to sake_path(@sake), class: 'btn btn-custom btn-circle' do %>
        <i class="fas fa-arrow-left"></i>
      <% end %>
    </div>
  </div>
</div>
